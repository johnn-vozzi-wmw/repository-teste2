--- VERSÃO 8.001

/*----------------------------------
Atividade: VENDAS-627
Autor: Gabriel Guedes
Data: 04/05/2022
Descricao: Nova tabela
----------------------------------*/

CREATE TABLE TBLVPFOTOPRODUTOGRADE (
   DSAGRUPADORGRADE     VARCHAR(100)         NOT NULL,
   NMFOTO               VARCHAR(100)         NOT NULL,
   CDFOTOPRODUTOGRADE   VARCHAR(20)          NULL,
   NUTAMANHO            DECIMAL(9)           NULL,
   DTMODIFICACAO        DATETIME             NULL,
   DIRFOTO              VARCHAR(1000)        NULL,
   NMEXTENSAO           VARCHAR(8)           NULL,
   CDUSUARIO			VARCHAR(20)			 NOT NULL,
   NUCARIMBO			DECIMAL(9)			 NULL,
   FLTIPOALTERACAO      CHAR(1)              NULL,
   DTALTERACAO          DATETIME             NULL,
   HRALTERACAO          VARCHAR(8)           NULL,
   CONSTRAINT PK_TBLVPFOTOPRODUTOGRADE PRIMARY KEY (DSAGRUPADORGRADE, NMFOTO, CDUSUARIO)
)
GO

/*----------------------------------
Atividade: VENDAS-572
Autor: Peterson Martins
Data: 04/05/2022
Descrição: Nova coluna para entidade TabelaPreco, funcionalidade de Bloqueia Campo para Edição.
----------------------------------*/
ALTER TABLE TBLVPTABELAPRECO ADD FLBLOQUEIANEGOCIACAO CHAR(1);
GO

/*-------------------------------------------------------------------------
Atividade: LAV-32243
Autor: Suelen Roecker
Data: 27/04/2022
Descrição: Alteração de Parametro e novas tabelas
-------------------------------------------------------------------------*/

CREATE TABLE TBLVPCATALOGOITEMPEDLOG (
	CDEMPRESA                 		VARCHAR(20)     NOT NULL,
	CDREPRESENTANTE           		VARCHAR(20)     NOT NULL,
	CDCATALOGOITEMPEDIDOLOG     	VARCHAR(20)     NOT NULL,
	NUSEQCATALOGOITEMPEDIDOLOG      DECIMAL(9)      NOT NULL,
	NUPEDIDO	                 	VARCHAR(30)		NULL,
    CDPRODUTO	                 	VARCHAR(20)		NULL,
	FLORIGEMPEDIDO 	   				CHAR(1)         NULL,
	FLTIPOITEMPEDIDO			 	CHAR(1) 		NULL,
	NUSEQPRODUTO 					DECIMAL(9) 		NULL,
	DTGERACAOCATALOGO				DATETIME        NULL,
	HRGERACAOCATALOGO 				VARCHAR(8)      NULL,
	VLITEMPEDIDO  					DECIMAL(16,7)   NULL,
	NUCARIMBO            			DECIMAL(9,0)    NULL,
   	FLTIPOALTERACAO      			CHAR(1)         NULL,
   	CDUSUARIO            			VARCHAR(8)      NOT NULL,
   	DTALTERACAO          			DATETIME        NULL,
   	HRALTERACAO          			VARCHAR(8)      NULL,
	CONSTRAINT PK_TBLVPCATALOGOITEMPEDLOG PRIMARY KEY(CDEMPRESA, CDREPRESENTANTE, CDCATALOGOITEMPEDIDOLOG, NUSEQCATALOGOITEMPEDIDOLOG, CDUSUARIO)
)
GO

--- VERSÃO 8.002

/*----------------------------------
Atividade: VENDAS-955
Autor: Fernando Hellmann
Data: 27/05/2022
Descricao: FotoProduto por empresa baixando novamente.
----------------------------------*/

ALTER TABLE TBLVPFOTOPRODUTO ADD HRMODIFICACAO VARCHAR(8);
GO
ALTER TABLE TBLVPFOTOPRODUTOEMP ADD HRMODIFICACAO VARCHAR(8);
GO
ALTER TABLE TBLVPFOTOPRODUTOGRADE ADD HRMODIFICACAO VARCHAR(8);
GO


--- VERSÃO 8.003

/*----------------------------------
Atividade: VENDAS-1096 / VENDAS-1135
Autor: Gabriel Guedes
Data: 20/06/2022
Descricao: Inconsistências de banco de dados Web/App
----------------------------------*/
ALTER TABLE TBLVPPROSPECT ADD TEMPCDLATITUDE DECIMAL(23, 20);
GO
ALTER TABLE TBLVPPROSPECT ADD TEMPCDLONGITUDE DECIMAL(23, 20);
GO

UPDATE TBLVPPROSPECT SET TEMPCDLATITUDE = CDLATITUDE, TEMPCDLONGITUDE = CDLONGITUDE;
UPDATE TBLVPPROSPECT SET CDLATITUDE = NULL, CDLONGITUDE = NULL;

--SQLSERVER
ALTER TABLE TBLVPPROSPECT ALTER COLUMN CDLATITUDE DECIMAL(23, 20);
GO
ALTER TABLE TBLVPPROSPECT ALTER COLUMN CDLONGITUDE DECIMAL(23, 20);
GO
--/SQLSERVER

--ORACLE
ALTER TABLE TBLVPPROSPECT MODIFY CDLATITUDE NUMBER(23, 20);
/
ALTER TABLE TBLVPPROSPECT MODIFY CDLONGITUDE NUMBER(23, 20);
/
--/ORACLE

--POSTGRES
ALTER TABLE TBLVPPROSPECT ALTER COLUMN CDLATITUDE TYPE DECIMAL(23, 20);
ALTER TABLE TBLVPPROSPECT ALTER COLUMN CDLONGITUDE TYPE DECIMAL(23, 20);
--/POSTGRES

UPDATE TBLVPPROSPECT SET CDLATITUDE = TEMPCDLATITUDE, CDLONGITUDE = TEMPCDLONGITUDE;

ALTER TABLE TBLVPPROSPECT DROP COLUMN TEMPCDLATITUDE;
GO
ALTER TABLE TBLVPPROSPECT DROP COLUMN TEMPCDLONGITUDE;
GO

/*----------------------------------
Atividade: VENDAS-1096 / VENDAS-1135
Autor: Gabriel Guedes
Data: 20/06/2022
Descricao: Inconsistências de banco de dados Web/App
----------------------------------*/
ALTER TABLE TBLVPRELNOVIDADENOVOCLI ADD TEMPDSMENSAGEM VARCHAR(4000);
GO

UPDATE TBLVPRELNOVIDADENOVOCLI SET TEMPDSMENSAGEM = DSMENSAGEM;
UPDATE TBLVPRELNOVIDADENOVOCLI SET DSMENSAGEM = NULL;

--SQLSERVER
ALTER TABLE TBLVPRELNOVIDADENOVOCLI ALTER COLUMN DSMENSAGEM VARCHAR(4000);
GO
--/SQLSERVER

--ORACLE
ALTER TABLE TBLVPRELNOVIDADENOVOCLI MODIFY DSMENSAGEM VARCHAR2(4000);
/
--/ORACLE

--POSTGRES
ALTER TABLE TBLVPRELNOVIDADENOVOCLI ALTER COLUMN DSMENSAGEM TYPE VARCHAR(4000);
--/POSTGRES

UPDATE TBLVPRELNOVIDADENOVOCLI SET DSMENSAGEM = TEMPDSMENSAGEM;

ALTER TABLE TBLVPRELNOVIDADENOVOCLI DROP COLUMN TEMPDSMENSAGEM;
GO


/*-------------------------------------------------------------------------
Atividade: LAV-33421
Autor: Matheus Schiavon
Data: 25/03/2022
Descrição: Alteração parametro 
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPCLIENTEENDERECO ADD CDREGISTRO VARCHAR(20);

/*-------------------------------------------------------------------------
Atividade: VENDAS-1336
Autor: Fernando Hellmann
Data: 21/03/2022
Descrição: Delete na tabela UsuarioCarimbo
-------------------------------------------------------------------------*/

DELETE FROM TBLVPUSUARIOCARIMBO WHERE NUCARIMBO IS NULL;

/*-------------------------------------------------------------------------
Atividade: VENDAS-1363
Autor: Fernando Hellmann
Data: 30/03/2022
Descrição: Alteração e criação de coluna
-------------------------------------------------------------------------*/

--ORACLE
ALTER TABLE TBLVPRECADO RENAME COLUMN CDEMPRESA TO CDEMPRESACLIENTE;
--/ORACLE

--POSTGRES
ALTER TABLE TBLVPRECADO RENAME COLUMN CDEMPRESA TO CDEMPRESACLIENTE;
--/POSTGRES

--SQLSERVER
EXEC SP_RENAME 'TBLVPRECADO.CDEMPRESA', 'CDEMPRESACLIENTE', 'COLUMN';
GO
--/SQLSERVER


ALTER TABLE TBLVPRECADO ADD CDREPRESENTANTECLIENTE VARCHAR(20) NULL;
GO

/*----------------------------------
Atividade: VENDAS-691
Autor: Rovani Pereira
Data: 24/04/2022
Descricao: Transição de colunas da entidade Empresa para a de Produto.
----------------------------------*/
ALTER TABLE TBLVPEMPRESA DROP COLUMN VLPCTJUROSMENSAL;
GO
ALTER TABLE TBLVPEMPRESA DROP COLUMN QTDIASCARENCIAJUROS;
GO
ALTER TABLE TBLVPPRODUTO ADD VLPCTJUROSMENSAL DECIMAL(16,7);
GO
ALTER TABLE TBLVPPRODUTO ADD QTDIASCARENCIAJUROS DECIMAL(9,0);
GO

/*-------------------------------------------------------------------------
Atividade: VENDAS-746
Autor: Ronan Cardoso
Descrição: Novas colunas
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPPEDIDO ADD DTSUGESTAOCLIENTE DATETIME;
GO

ALTER TABLE TBLVPPEDIDOERP ADD DTSUGESTAOCLIENTE DATETIME;
GO

/*-------------------------------------------------------------------------
Atividade: VENDAS-830
Autor: Ronan Cardoso
Descrição: Novas tabelas para estoque por cotas
-------------------------------------------------------------------------*/
CREATE TABLE TBLVPESTOQUEINDUSTRIAGERAL (
	CDEMPRESA 				VARCHAR(20)			NOT NULL,
	CDREPRESENTANTE      	VARCHAR(20)			NOT NULL,
	CDINSUMO          		VARCHAR(20)		    NOT NULL,
	CDLOCALESTOQUE  		VARCHAR(20)			NOT NULL,
	FLORIGEMESTOQUE   		VARCHAR(1)			NOT NULL,
	DTESTOQUE   	    	DATETIME			NOT NULL,
    CDCENTROCUSTO			VARCHAR(20)		    NOT NULL,
	QTESTOQUE  		        DECIMAL(16,7)		NULL,
	FLTIPOALTERACAO      	CHAR(1)             NULL,
	DTALTERACAO             DATETIME            NULL,
    HRALTERACAO             VARCHAR(8)          NULL,
    NUCARIMBO               DECIMAL(9,0)        NULL,
    CDUSUARIO               VARCHAR(8)          NOT NULL,
	CONSTRAINT PK_TBLVPESTOQUEINDUSTRIAGERAL PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDINSUMO, CDLOCALESTOQUE, FLORIGEMESTOQUE, DTESTOQUE, CDCENTROCUSTO, CDUSUARIO)
)
GO

CREATE TABLE TBLVPESTOQUEPREVISTOGERAL (
    CDEMPRESA 				VARCHAR(20)			NOT NULL,
	CDREPRESENTANTE      	VARCHAR(20)			NOT NULL,
    CDPRODUTO  		        VARCHAR(20)			NOT NULL,
    CDITEMGRADE1	        VARCHAR(20)			NOT NULL,
    CDITEMGRADE2	        VARCHAR(20)			NOT NULL,
    CDITEMGRADE3	        VARCHAR(20)			NOT NULL,
    CDLOCALESTOQUE	        VARCHAR(20)			NOT NULL,
    FLORIGEMESTOQUE         CHAR(1)             NOT NULL,
    DTESTOQUE             	DATETIME            NOT NULL,
    QTESTOQUE              	DECIMAL(16,7)       NULL,
	FLTIPOALTERACAO      	CHAR(1)             NULL,
    DTALTERACAO             DATETIME            NULL,
    HRALTERACAO             VARCHAR(8)          NULL,
    NUCARIMBO               DECIMAL(9,0)        NULL,
    CDUSUARIO               VARCHAR(8)          NOT NULL,
	CONSTRAINT PK_TBLVPESTOQUEPREVISTOGERAL PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDPRODUTO, CDITEMGRADE1, CDITEMGRADE2, CDITEMGRADE3, CDLOCALESTOQUE, FLORIGEMESTOQUE, DTESTOQUE, CDUSUARIO)
)
GO

ALTER TABLE TBLVPRESERVACORRENTE ADD CDCENTROCUSTO VARCHAR(20);
GO

ALTER TABLE TBLVPESTOQUEINDUSTRIA DROP CONSTRAINT PK_TBLVPESTOQUEINDUSTRIA;
GO

--ORACLE
DECLARE
COUNT_INDEXES INTEGER;
BEGIN
SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPESTOQUEINDUSTRIA';
IF COUNT_INDEXES > 0 THEN
EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPESTOQUEINDUSTRIA';
END IF;
END;
--/ORACLE
GO

ALTER TABLE TBLVPESTOQUEINDUSTRIA ADD CDCENTROCUSTO VARCHAR(20) DEFAULT '0' NOT NULL;
GO

ALTER TABLE TBLVPESTOQUEINDUSTRIA ADD CONSTRAINT PK_TBLVPESTOQUEINDUSTRIA PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDINSUMO, CDLOCALESTOQUE, FLORIGEMESTOQUE, DTESTOQUE, CDCENTROCUSTO, CDUSUARIO);
GO

--- VERSÃO 8.005

/*-------------------------------------------------------------------------
VENDAS-1026
Autor: Suelen Roecker
Descricao: Nova tabela
-------------------------------------------------------------------------*/

CREATE TABLE TBLVPCATALOGOEXTERNO (
	CDCATALOGOEXTERNO 		VARCHAR(20)			NOT NULL,
	CDEMPRESA 				VARCHAR(20)			NOT NULL,
	DSCATALOGOEXTERNO       VARCHAR(100)	        NULL,
	NMARQUIVO   			VARCHAR(100)		NULL,
	NUTAMANHO				DECIMAL(9) 			NULL,
	NMEXTENSAO  			VARCHAR(8)          NULL,
	CDUSUARIO				VARCHAR(20)			 NOT NULL,
	NUCARIMBO				DECIMAL(9)			 NULL,
	FLTIPOALTERACAO			CHAR(1)              NULL,
	DTALTERACAO				DATETIME             NULL,
	HRALTERACAO				VARCHAR(8)           NULL,
	CONSTRAINT PK_TBLVPCATALOGOEXTERNO PRIMARY KEY (CDCATALOGOEXTERNO, CDEMPRESA, CDUSUARIO)
)
GO

--- VERSÃO 8.006

/*----------------------------------
Atividade: VENDAS-1847
Autor: Éber Mainardes
Data: 05/08/2022
Descricao: Colunas para armazenamento de cálculo alternativo da rentabilidade 9 dos pedidos.
----------------------------------*/
ALTER TABLE TBLVPPEDIDO ADD VLRENTABTOTALITENS DECIMAL(16,7);
GO
ALTER TABLE TBLVPPEDIDO ADD VLRENTABSUGITENS DECIMAL(16,7);
GO
ALTER TABLE TBLVPPEDIDOERP ADD VLRENTABTOTALITENS DECIMAL(16,7);
GO
ALTER TABLE TBLVPPEDIDOERP ADD VLRENTABSUGITENS DECIMAL(16,7);
GO

--- VERSÃO 8.007

/*-------------------------------------------------------------------------
VENDAS-1731
Autor: Renan
Descricao: Novas colunas
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPITEMKIT ADD FLBONIFICADO CHAR(1);
GO

ALTER TABLE TBLVPITEMKITAGRSIMILAR ADD FLBONIFICADO CHAR(1);
GO

UPDATE TBLVPITEMKIT SET FLBONIFICADO = 'N';
UPDATE TBLVPITEMKITAGRSIMILAR SET FLBONIFICADO = 'N';

--SQLSERVER
ALTER TABLE TBLVPITEMKIT ALTER COLUMN FLBONIFICADO CHAR(1) NOT NULL;
GO
ALTER TABLE TBLVPITEMKITAGRSIMILAR ALTER COLUMN FLBONIFICADO CHAR(1) NOT NULL;
GO
--/SQLSERVER

--ORACLE
ALTER TABLE TBLVPITEMKIT MODIFY FLBONIFICADO CHAR(1) NOT NULL;
ALTER TABLE TBLVPITEMKITAGRSIMILAR MODIFY FLBONIFICADO CHAR(1) NOT NULL;
--/ORACLE

--POSTGRES
ALTER TABLE TBLVPITEMKIT ALTER COLUMN FLBONIFICADO SET NOT NULL;
ALTER TABLE TBLVPITEMKITAGRSIMILAR ALTER COLUMN FLBONIFICADO SET NOT NULL;
--/POSTGRES

ALTER TABLE TBLVPITEMKIT DROP CONSTRAINT PK_TBLVPITEMKIT;
GO

ALTER TABLE TBLVPITEMKITAGRSIMILAR DROP CONSTRAINT PK_TBLVPITEMKITAGRSIMILAR;
GO

--ORACLE
DECLARE
COUNT_INDEXES INTEGER;
BEGIN
SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPITEMKIT';
IF COUNT_INDEXES > 0 THEN
EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPITEMKIT';
END IF;
END;
--/ORACLE

--ORACLE
DECLARE
COUNT_INDEXES INTEGER;
BEGIN
SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPITEMKITAGRSIMILAR';
IF COUNT_INDEXES > 0 THEN
EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPITEMKITAGRSIMILAR';
END IF;
END;
--/ORACLE

ALTER TABLE TBLVPITEMKIT ADD CONSTRAINT PK_TBLVPITEMKIT PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDKIT, CDPRODUTO, CDTABELAPRECO, CDUNIDADE, FLBONIFICADO, CDUSUARIO);
GO

ALTER TABLE TBLVPITEMKITAGRSIMILAR ADD CONSTRAINT PK_TBLVPITEMKITAGRSIMILAR PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDKIT, CDPRODUTO, CDTABELAPRECO, CDPRODUTOSIMILAR, FLBONIFICADO, CDUSUARIO);
GO

/*----------------------------------
Atividade: VENDAS-1890
Autor: Suelen Roecker
Data: 09/08/2022
Descricao: Ajuste de PK Catalgo Externo
----------------------------------*/

ALTER TABLE TBLVPCATALOGOEXTERNO DROP CONSTRAINT PK_TBLVPCATALOGOEXTERNO;
GO

--ORACLE
DECLARE
  COUNT_INDEXES INTEGER;
  COUNT_CONSTR INTEGER;
BEGIN
  SELECT COUNT(*) INTO COUNT_CONSTR FROM USER_CONSTRAINTS WHERE CONSTRAINT_NAME = 'PK_TBLVPCATALOGOEXTERNO';
  IF COUNT_CONSTR > 0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE TBLVPCATALOGOEXTERNO DROP CONSTRAINT PK_TBLVPCATALOGOEXTERNO';
  END IF;
  SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPCATALOGOEXTERNO';
  IF COUNT_INDEXES > 0 THEN
    EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPCATALOGOEXTERNO';
  END IF;
END;
/
--/ORACLE

ALTER TABLE TBLVPCATALOGOEXTERNO ADD CONSTRAINT PK_TBLVPCATALOGOEXTERNO PRIMARY KEY (CDEMPRESA, CDCATALOGOEXTERNO, CDUSUARIO);
GO

--- VERSÃO 8.008

/*----------------------------------
Atividade: VENDAS-688
Autor: Renan
Data: 22/06/2022
Descricao: Nova tabela
----------------------------------*/
ALTER TABLE TBLVPBONIFCFG ADD QTSALDOCONTACORRENTE DECIMAL(16,7) NULL;
GO

CREATE TABLE TBLVPBONIFCFGCLIENTE (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	CDCLIENTE VARCHAR(20) NOT NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFGCLIENTE PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDCLIENTE,CDUSUARIO)
);
GO

ALTER TABLE TBLVPTIPOPEDIDO ADD FLBONIFICACAOCONTACORRENTE CHAR(1) NULL;
GO

ALTER TABLE TBLVPTIPOPEDIDO ADD FLIGNORAPOLITICABONIFICACAO CHAR(1) NULL;
GO

/*------------------------------------------------------------------------
VENDAS-2224
Autor: Fernando
Descrição: Nova coluna
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPPEDIDO ADD dsQrCodePix VARCHAR(4000);
GO
ALTER TABLE TBLVPPEDIDOERP ADD dsQrCodePix VARCHAR(4000);
GO

--- VERSÃO 8.009

--- VERSÃO 8.010

/*-------------------------------------------------------------------------
Atividade: VENDAS-1003
Data: 31/08/2022
Autor: Matheus Schiavon
Descrição: Gerencia de região de venda de clientes e vendedores V3
------------------------------------------------------------------------*/
ALTER TABLE TBLVPBAIRRO ADD CDCIDADE VARCHAR(20);
GO
ALTER TABLE TBLVPCLIENTE ADD FLCOMCOMODATO CHAR(1);
GO

/*-------------------------------------------------------------------------
Atividade: VENDAS-2189
Autor: Urian Almeida
Data: 23/09/2022
DescriÃ§Ã£o: Campo de busca na tela de apontamentos de estoque do faceamento
-------------------------------------------------------------------------*/

UPDATE TBLVPVALORPARAMETRO SET VLPARAMETRO = REPLACE(VLPARAMETRO, '}', ', "usaFiltroGrupoFaceamento":"N"}')
WHERE CDPARAMETRO = 132 AND CDSISTEMA = 1 AND VLPARAMETRO NOT LIKE '%usaFiltroGrupoFaceamento%';

UPDATE TBLVPVALORPARAMETRO SET VLPARAMETRO = REPLACE('{"usa":"[0]", "usaFiltroAtivoFaceamento":"N"}', '[0]', VLPARAMETRO) WHERE CDPARAMETRO = 300 AND CDSISTEMA = 1 AND VLPARAMETRO NOT LIKE '%usa%';

/*----------------------------------
Atividade: VENDAS-2276
Autor: Anderson Longará
Data: 08/09/2022
Descricao: Nova tabela
----------------------------------*/
CREATE TABLE TBLVPDIVISAOVENDA (
   CDEMPRESA            VARCHAR(20)          NOT NULL,
   CDREPRESENTANTE      VARCHAR(20)          NOT NULL,
   CDDIVISAOVENDA       VARCHAR(20)          NOT NULL,
   DSDIVISAOVENDA       VARCHAR(100)         NULL,
   FLIGNORAVERBAGRPPROD CHAR(1)              NULL,
   CDUSUARIO			VARCHAR(20)			 NOT NULL,
   NUCARIMBO			DECIMAL(9)			 NULL,
   FLTIPOALTERACAO      CHAR(1)              NULL,
   DTALTERACAO          DATETIME             NULL,
   HRALTERACAO          VARCHAR(8)           NULL,
   CONSTRAINT PK_TBLVPDIVISAOVENDA PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDDIVISAOVENDA, CDUSUARIO)
);
GO

ALTER TABLE TBLVPPEDIDO ADD CDDIVISAOVENDA VARCHAR(20) NULL;
GO

ALTER TABLE TBLVPPEDIDOERP ADD CDDIVISAOVENDA VARCHAR(20) NULL;
GO

/*----------------------------------
ATIVIDADE: VENDAS-1206
AUTOR: Gabriel Guedes
DATA: 04/05/2022
DESCRICAO: Nova tabela
----------------------------------*/

CREATE TABLE TBLVPMENUCATALOGO (
	CDFUNCIONALIDADE	VARCHAR(30)		NOT NULL,
	NUNIVEL				DECIMAL(9,0)    NOT NULL,
	NMENTIDADE			VARCHAR(30)		NULL,
	NMMENU				VARCHAR(100)    NULL,
	DSSQL				TEXT            NULL,
	NUCARIMBO			DECIMAL(9,0)    NULL,
	FLTIPOALTERACAO		CHAR(1)         NULL,
	DTALTERACAO			DATETIME        NULL,
	HRALTERACAO			VARCHAR(8)      NULL,
	CDUSUARIO           VARCHAR(20)     NOT NULL,
	CONSTRAINT PK_TBLVPMENUCATALOGO PRIMARY KEY (CDFUNCIONALIDADE, NUNIVEL, CDUSUARIO)
);
GO

/*----------------------------------
Atividade: VENDAS-1162
Autor: Anderson Longará
Data: 25/07/2022
Descricao: Criação de novas colunas TBLVWVERBAGRUPOSALDO
----------------------------------*/

ALTER TABLE TBLVPVERBAGRUPOSALDO ADD NUORDEMLIBERACAO DECIMAL(9);
GO
ALTER TABLE TBLVPVERBAGRUPOSALDO ADD CDMOTIVOPENDENCIA VARCHAR(20);
GO
ALTER TABLE TBLVPVERBAGRUPOSALDO ADD DTATUALIZACAOVLSALDO DATETIME;
GO
ALTER TABLE TBLVPVERBAGRUPOSALDO ADD HTATUALIZACAOVLSALDO VARCHAR(8);
GO

/*----------------------------------
Atividade: VENDAS-1876
Autor: Anderson Longará
Data: 05/09/2022
Descricao: Cria nova coluna na tabela Cliente.
----------------------------------*/
ALTER TABLE TBLVPCLIENTE ADD FLIGNORAVERBAGRPPROD CHAR(1);
GO

--- VERSÃO 8.011

--- VERSÃO 8.012

/*----------------------------------
ATIVIDADE: VENDAS-2503
AUTOR: Suelen Roecker
DATA: 03/10/2022
DESCRICAO: Novas colunas
----------------------------------*/

ALTER TABLE TBLVPPEDIDO ADD VLMINPEDIDOTRANSPREG  DECIMAL(16,7);
ALTER TABLE TBLVPPEDIDOERP ADD VLMINPEDIDOTRANSPREG DECIMAL(16,7);
GO

/*-------------------------------------------------------------------------
Atividade: VENDAS-1722
Autor: Éber Mainardes
Data: 19/08/2022
Descrição: Rentabilidade do Item no RDVi
-------------------------------------------------------------------------*/
--SQLSERVER
ALTER TABLE TBLVPFORMULACALCULOSQL ADD FLTIPOSISTEMA CHAR(1) NOT NULL DEFAULT 'P';
GO
--/SQLSERVER
 
--ORACLE
ALTER TABLE TBLVPFORMULACALCULOSQL ADD FLTIPOSISTEMA CHAR(1) DEFAULT 'P' NOT NULL;
GO
--/ORACLE
 
--POSTGRES
ALTER TABLE TBLVPFORMULACALCULOSQL ADD COLUMN FLTIPOSISTEMA CHAR(1) DEFAULT 'P' NOT NULL;
GO
--/POSTGRES
 
 
ALTER TABLE TBLVPFORMULACALCULOSQL DROP CONSTRAINT PK_TBLVPFORMULACALCULOSQL;
GO
 
--ORACLE
DECLARE
    COUNT_INDEXES INTEGER;
BEGIN
    SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPFORMULACALCULOSQL';
    IF COUNT_INDEXES > 0 THEN
        EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPFORMULACALCULOSQL';
    END IF;
END;
/
--/ORACLE
 
 
ALTER TABLE TBLVPFORMULACALCULOSQL ADD CONSTRAINT PK_TBLVPFORMULACALCULOSQL PRIMARY KEY (CDFORMULACALCULO, CDFORMULACALCULOSQL, FLTIPOSISTEMA, CDUSUARIO);
GO

/*----------------------------------
ATIVIDADE: VENDAS-2319
AUTOR: Gabriel Guedes
DATA: 04/10/2022
DESCRICAO: Novas tabelas
----------------------------------*/

CREATE TABLE TBLVPVIDEOPRODUTO (
    CDEMPRESA       VARCHAR(20)     NOT NULL,
    CDPRODUTO       VARCHAR(20)     NOT NULL,
    NMVIDEO         VARCHAR(100)    NOT NULL,
    CDVIDEOPRODUTO  VARCHAR(20),
    DSURLVIDEO      VARCHAR(1000),
    DTMODIFICACAO   DATETIME,
    HRMODIFICACAO   VARCHAR(8),
    NUCARIMBO       DECIMAL(9,0),
    FLTIPOALTERACAO CHAR(1),
    DTALTERACAO     DATETIME,
    HRALTERACAO     VARCHAR(8),
    CDUSUARIO       VARCHAR(20)     NOT NULL,
    CONSTRAINT PK_TBLVPVIDEOPRODUTO PRIMARY KEY (CDEMPRESA, CDPRODUTO, NMVIDEO, CDUSUARIO)
);
GO

CREATE TABLE TBLVPVIDEOPRODUTOGRADE (
    CDEMPRESA           VARCHAR(20)     NOT NULL,
    DSAGRUPADORGRADE    VARCHAR(100)     NOT NULL,
    NMVIDEO             VARCHAR(100)    NOT NULL,
    CDVIDEOPRODUTOGRADE VARCHAR(20),
    DSURLVIDEO          VARCHAR(1000),
    DTMODIFICACAO       DATETIME,
    HRMODIFICACAO       VARCHAR(8),
    NUCARIMBO           DECIMAL(9,0),
    FLTIPOALTERACAO     CHAR(1),
    DTALTERACAO         DATETIME,
    HRALTERACAO         VARCHAR(8),
    CDUSUARIO           VARCHAR(20)     NOT NULL,
    CONSTRAINT PK_TBLVPVIDEOPRODUTOGRADE PRIMARY KEY (CDEMPRESA, DSAGRUPADORGRADE, NMVIDEO, CDUSUARIO)
);
GO

/*----------------------------
Atividade: VENDAS-2575
Autor: Rovani Pereira
Data: 06/10/2022
Descrição: Script para colocar colunas das tabelas do sistema no tamanho padrão.
-------------------------------*/

--SQLSERVER
BEGIN
	DECLARE @NMTABELA VARCHAR(200);
	DECLARE @NMCOLUNA VARCHAR(200);
	DECLARE CURSORTABELACOLUNA CURSOR FOR 
		SELECT NMTABELA, NMCOLUNA FROM (
			SELECT 'TBLVPCLIENTE' AS NMTABELA, 'VLPCTVPC' AS NMCOLUNA
			UNION ALL SELECT 'TBLVPITEMPEDIDO', 'VLTOTALFECOPITEM'
			UNION ALL SELECT 'TBLVPITEMPEDIDO', 'VLVPC'
			UNION ALL SELECT 'TBLVPITEMPEDIDOERP', 'VLTOTALFECOPITEM'
			UNION ALL SELECT 'TBLVPITEMPEDIDOERP', 'VLVPC'
			UNION ALL SELECT 'TBLVPPEDIDO', 'VLPCTVPC'
			UNION ALL SELECT 'TBLVPPEDIDOERP', 'VLPCTVPC'
			UNION ALL SELECT 'TBLVPPRODUTO', 'VLPCTVARIACAOCOMISSAO') TABELACOLUNA
	
	OPEN CURSORTABELACOLUNA
    FETCH NEXT FROM CURSORTABELACOLUNA INTO @NMTABELA, @NMCOLUNA

	WHILE @@FETCH_STATUS = 0
		BEGIN
			BEGIN TRY 
				EXECUTE ('ALTER TABLE ' + @NMTABELA + ' ALTER COLUMN ' + @NMCOLUNA + ' DECIMAL(16,7)');
			END TRY
			BEGIN CATCH
			--FAZ NADA, VAI PARA O PROXIMO
			END CATCH;
		FETCH NEXT FROM CURSORTABELACOLUNA INTO @NMTABELA, @NMCOLUNA
		END;
	CLOSE CURSORTABELACOLUNA
    DEALLOCATE CURSORTABELACOLUNA
END;
--/SQLSERVER

--ORACLE
BEGIN
    FOR TABELACOLUNA IN (
        SELECT NMTABELA, NMCOLUNA FROM (
        SELECT 'TBLVPCLIENTE' AS NMTABELA, 'VLPCTVPC' AS NMCOLUNA FROM DUAL
        UNION ALL SELECT 'TBLVPITEMPEDIDO', 'VLTOTALFECOPITEM' FROM DUAL
        UNION ALL SELECT 'TBLVPITEMPEDIDO', 'VLVPC' FROM DUAL
        UNION ALL SELECT 'TBLVPITEMPEDIDOERP', 'VLTOTALFECOPITEM' FROM DUAL
        UNION ALL SELECT 'TBLVPITEMPEDIDOERP', 'VLVPC' FROM DUAL
        UNION ALL SELECT 'TBLVPPEDIDO', 'VLPCTVPC' FROM DUAL
        UNION ALL SELECT 'TBLVPPEDIDOERP', 'VLPCTVPC' FROM DUAL
        UNION ALL SELECT 'TBLVPPRODUTO', 'VLPCTVARIACAOCOMISSAO' FROM DUAL )
    ) LOOP
        BEGIN
            EXECUTE IMMEDIATE 'ALTER TABLE ' || TABELACOLUNA.NMTABELA || ' MODIFY '|| TABELACOLUNA.NMCOLUNA ||' NUMBER(16,7)';
            EXCEPTION WHEN OTHERS THEN
                CONTINUE;
        END;
    END LOOP;    
END;
/
--/ORACLE

--POSTGRES
DO $$
	DECLARE 
	TABELACOLUNA RECORD;
	DSSCRIPT TEXT;
	BEGIN
		 FOR TABELACOLUNA IN (SELECT NMTABELA, NMCOLUNA FROM (
			SELECT 'TBLVPCLIENTE' AS NMTABELA, 'VLPCTVPC' AS NMCOLUNA
			UNION ALL SELECT 'TBLVPITEMPEDIDO', 'VLTOTALFECOPITEM'
			UNION ALL SELECT 'TBLVPITEMPEDIDO', 'VLVPC'
			UNION ALL SELECT 'TBLVPITEMPEDIDOERP', 'VLTOTALFECOPITEM'
			UNION ALL SELECT 'TBLVPITEMPEDIDOERP', 'VLVPC'
			UNION ALL SELECT 'TBLVPPEDIDO', 'VLPCTVPC'
			UNION ALL SELECT 'TBLVPPEDIDOERP', 'VLPCTVPC'
			UNION ALL SELECT 'TBLVPPRODUTO', 'VLPCTVARIACAOCOMISSAO') VALORES) loop
		DSSCRIPT := REPLACE(REPLACE('ALTER TABLE [0] ALTER COLUMN [1] TYPE DECIMAL(16,7)','[0]', TABELACOLUNA.NMTABELA), '[1]', TABELACOLUNA.NMCOLUNA);
		BEGIN
			EXECUTE DSSCRIPT; 
			EXCEPTION 
				WHEN OTHERS THEN
   				CONTINUE;
   		END;
	END LOOP;
	END;
$$;
--/POSTGRES