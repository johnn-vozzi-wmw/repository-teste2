--VERSAO 7.000

--VERSAO 7.001

/*-------------------------------------------------------------------------
Atividade: LAV-31575
Autor: Rovani Pereira
Data: 11/10/2021
Descrição: Nova coluna para Entidade CondPagto, funcionalidade de Documento Anexo.
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPCONDICAOPAGAMENTO ADD FLOBRIGAANEXODOCUMENTO CHAR(1);

--VERSAO 7.002

/*-------------------------------------------------------------------------
LAV-31464
Autor: Matheus Schiavon
Descrição: Lowell - Politicas de bonificação: estrutura e cadastros (app e web)
-------------------------------------------------------------------------*/
CREATE TABLE TBLVPBONIFCFG (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	DSBONIFCFG VARCHAR(20) NULL,
	DTVIGENCIAINI DATETIME NULL,
	DTVIGENCIAFIM DATETIME NULL,
	FLOPCIONAL CHAR(1) NULL,
	VLPCTSOBREVENDA DECIMAL(16,7) NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFG PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDUSUARIO)
);
GO 

CREATE TABLE TBLVPBONIFCFGFAIXAQTDE (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	CDFAIXAQTDE VARCHAR(20) NOT NULL,
	QTVENDIDA DECIMAL(16,7) NULL,
	QTBONIFICADA DECIMAL(16,7) NULL,
	FLCONCEDEBRINDES CHAR(1) NULL,
	FLCONCEDEMULTIPLOS CHAR(1) NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFGFAIXAQTDE PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDFAIXAQTDE,CDUSUARIO)
);
GO

CREATE TABLE TBLVPBONIFCFGBRINDE (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	CDPRODUTO VARCHAR(20) NOT NULL,
	QTBRINDE DECIMAL(16,7) NULL,
	FLOPCIONAL CHAR(1) NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFGBRINDE PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDPRODUTO,CDUSUARIO)
);
GO

CREATE TABLE TBLVPBONIFCFGFAMILIA (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	CDFAMILIA VARCHAR(20) NOT NULL,
	FLGERABONIFICACAO CHAR(1) NULL,
	FLPERMITEBONIFICAR CHAR(1) NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFGFAMILIA PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDFAMILIA,CDUSUARIO)
);
GO

CREATE TABLE TBLVPBONIFCFGLINHA (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	CDLINHA VARCHAR(20) NOT NULL,
	FLGERABONIFICACAO CHAR(1) NULL,
	FLPERMITEBONIFICAR CHAR(1) NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFGLINHA PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDLINHA,CDUSUARIO)
);
GO

CREATE TABLE TBLVPBONIFCFGPRODUTO (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	CDPRODUTO VARCHAR(20) NOT NULL,
	FLGERABONIFICACAO CHAR(1) NULL,
	FLPERMITEBONIFICAR CHAR(1) NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFGPRODUTO PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDPRODUTO,CDUSUARIO)
);
GO

CREATE TABLE TBLVPBONIFCFGCATEGORIA (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	CDCATEGORIA VARCHAR(20) NOT NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFGCATEGORIA PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDCATEGORIA,CDUSUARIO)
);
GO

CREATE TABLE TBLVPBONIFCFGREPRESENTANTE (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	CDREPRESENTANTE VARCHAR(20) NOT NULL,
	FLTIPOALTERACAO CHAR(1) NULL,
	DTALTERACAO DATETIME NULL,
	HRALTERACAO VARCHAR(8) NULL,
	NUCARIMBO DECIMAL(9,0) NULL,
	CDUSUARIO VARCHAR(8) NOT NULL,
	CONSTRAINT PK_TBLVPBONIFCFGREPRESENTANTE PRIMARY KEY (CDEMPRESA,CDBONIFCFG,CDREPRESENTANTE,CDUSUARIO)
);
GO

--VERSAO 7.003

/*-------------------------------------------------------------------------
LAV-29796
Autor: Matheus Schiavon
Descrição: Adição tabela e colunas;
-------------------------------------------------------------------------*/
CREATE TABLE TBLVPDESCQUANTPESOPRDBLQ (
    CDEMPRESA       varchar(20)     NOT NULL,
    CDREPRESENTANTE       varchar(20)     NOT NULL,
    CDTABELAPRECO   varchar(30)	NOT NULL,
    CDPRODUTO   varchar(20)	NOT NULL,   
    FLATIVO			CHAR(1)			    NULL,
	FLTIPOALTERACAO	CHAR(1)			    NULL,
	DTALTERACAO     date            NULL,
   	HRALTERACAO     varchar(8)          NULL,
	CDUSUARIO				VARCHAR(8)			NOT NULL,
	NUCARIMBO				DECIMAL(9,0)			NULL,
    CONSTRAINT PK_TBLVPDESCQUANTPESOPRDBLQ PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDTABELAPRECO, CDPRODUTO)
)
GO

ALTER TABLE TBLVPDESCQUANTIDADEPESO ADD CDTABELAPRECO varchar(30) DEFAULT '0' NOT NULL;
GO

ALTER TABLE TBLVPDESCQUANTIDADEPESO DROP CONSTRAINT PK_TBLVPDESCQUANTIDADEPESO;
GO

--ORACLE
DECLARE COUNT_INDEXES INTEGER; BEGIN SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPDESCQUANTIDADEPESO'; IF COUNT_INDEXES > 0 THEN EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPDESCQUANTIDADEPESO'; END IF; END;
/
--/ORACLE

ALTER TABLE TBLVPDESCQUANTIDADEPESO ADD CONSTRAINT PK_TBLVPDESCQUANTIDADEPESO PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, VLPESO, CDTABELAPRECO, CDUSUARIO);
GO

/*-------------------------------------------------------------------------
Atividade: LAV-32543
Autor: Anderson Gaspar
Data: 29/10/2021
Descrição: Nova coluna para Entidade TipoPedido, funcionalidade de Observação.
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPTIPOPEDIDO ADD FLOBRIGAOBSERVACAO CHAR(1);
GO

/*----------------------------
Atividade: LAV-32168
Autor: Peterson Martins
Data: 08/11/2021
DescriÃ§Ã£o: Percentual de comissÃ£o. Funcionalidade calculo de comissÃ£o por representante.
-------------------------------*/

ALTER TABLE TBLVPTABELAPRECOREP ADD VLPCTCOMISSAO DECIMAL(16,7);
GO

/*----------------------------
Atividade: LAV-32785
Autor: Gabriel Guedes
Data: 24/11/2021
Descrição: Correção de inconsistências de tamanhos de colunas entre banco App e Web
-----------------------------*/

--SQLSERVER
ALTER TABLE TBLVPEMPRESA ALTER COLUMN CDESTADO VARCHAR(20);
GO
ALTER TABLE TBLVPENVIOCAMPANHAPUB ALTER COLUMN DSCAMPANHAPUBLICITARIA VARCHAR(100);
GO
--/SQLSERVER

--ORACLE
ALTER TABLE TBLVPEMPRESA MODIFY CDESTADO VARCHAR(20);
/
ALTER TABLE TBLVPENVIOCAMPANHAPUB MODIFY DSCAMPANHAPUBLICITARIA VARCHAR(100);
/
--/ORACLE

--POSTGRES
ALTER TABLE TBLVPEMPRESA ALTER COLUMN CDESTADO TYPE VARCHAR(20);
ALTER TABLE TBLVPENVIOCAMPANHAPUB ALTER COLUMN DSCAMPANHAPUBLICITARIA TYPE VARCHAR(100);
--/POSTGRES

--VERSAO 7.004

/*-------------------------------------------------------------------------
ATIVIDADE: LAV-31909
AUTOR: Ronan Cardoso
DATA: 05/10/2021
DESCRIÇÃO: Alteração de colunas da tabela SOLAUTORIZACAO, pk e novas colunas.
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPSOLAUTORIZACAO DROP CONSTRAINT pk_tblvpsolautorizacao;
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO DROP CONSTRAINT pk_tblvprelnovsolautorizacao;
GO

--ORACLE
ALTER TABLE TBLVPSOLAUTORIZACAO MODIFY CDSOLAUTORIZACAO VARCHAR(100);
/
ALTER TABLE TBLVPSOLAUTORIZACAO MODIFY FLORIGEMPEDIDO CHAR(1) NULL;
/
ALTER TABLE TBLVPSOLAUTORIZACAO MODIFY NUPEDIDO VARCHAR(30) NULL;
/
ALTER TABLE TBLVPSOLAUTORIZACAO MODIFY CDCLIENTE VARCHAR(20) NULL;
/
ALTER TABLE TBLVPSOLAUTORIZACAO MODIFY CDPRODUTO VARCHAR(20) NULL;
/
ALTER TABLE TBLVPSOLAUTORIZACAO MODIFY FLTIPOITEMPEDIDO CHAR(1) NULL;
/
ALTER TABLE TBLVPSOLAUTORIZACAO MODIFY NUSEQPRODUTO DECIMAL(9,0) NULL;
/
ALTER TABLE TBLVPSOLAUTORIZACAO MODIFY CDTIPOSOLAUTORIZACAO DECIMAL(9,0) NULL;
/
ALTER TABLE TBLVPSOLAUTORIZACAO RENAME COLUMN FLITEMEXCLUIDO to FLEXCLUIDO;
/
UPDATE TBLVPSOLAUTORIZACAO SET CDSOLAUTORIZACAO = (CDSOLAUTORIZACAO || FLORIGEMPEDIDO || NUPEDIDO || CDPRODUTO || FLTIPOITEMPEDIDO || NUSEQPRODUTO || CDTIPOSOLAUTORIZACAO || CDCLIENTE);
/

ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO MODIFY CDSOLAUTORIZACAO VARCHAR(100);
/
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO MODIFY CDTIPOSOLAUTORIZACAO DECIMAL(9,0) NULL;
/
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO MODIFY FLORIGEMPEDIDO CHAR(1) NULL;
/
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO MODIFY NUPEDIDO VARCHAR(30) NULL;
/
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO MODIFY CDCLIENTE VARCHAR(20) NULL;
/
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO MODIFY CDPRODUTO VARCHAR(20) NULL;
/
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO MODIFY FLTIPOITEMPEDIDO CHAR(1) NULL;
/
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO MODIFY NUSEQPRODUTO DECIMAL(9,0) NULL;
/
UPDATE TBLVPRELNOVSOLAUTORIZACAO SET CDSOLAUTORIZACAO = (CDSOLAUTORIZACAO || NUPEDIDO || CDPRODUTO || CDTIPONOVIDADE || CDTIPOSOLAUTORIZACAO || FLORIGEMPEDIDO || FLTIPOITEMPEDIDO || NUSEQPRODUTO || CDCLIENTE);
/
DECLARE COUNT_INDEXES INTEGER; BEGIN SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPSOLAUTORIZACAO'; IF COUNT_INDEXES > 0 THEN EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPSOLAUTORIZACAO'; END IF; END;
/
DECLARE COUNT_INDEXES INTEGER; BEGIN SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPRELNOVSOLAUTORIZACAO'; IF COUNT_INDEXES > 0 THEN EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPRELNOVSOLAUTORIZACAO'; END IF; END;
/
--/ORACLE

--POSTGRES
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN CDSOLAUTORIZACAO TYPE varchar(100);
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN FLORIGEMPEDIDO DROP NOT NULL;
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN NUPEDIDO DROP NOT NULL;
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN CDCLIENTE DROP NOT NULL;
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN CDPRODUTO DROP NOT NULL;
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN FLTIPOITEMPEDIDO DROP NOT NULL;
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN NUSEQPRODUTO DROP NOT NULL;
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN CDTIPOSOLAUTORIZACAO DROP NOT NULL;
ALTER TABLE TBLVPSOLAUTORIZACAO RENAME COLUMN FLITEMEXCLUIDO to FLEXCLUIDO;
UPDATE TBLVPSOLAUTORIZACAO SET CDSOLAUTORIZACAO = (CDSOLAUTORIZACAO || FLORIGEMPEDIDO || NUPEDIDO || CDPRODUTO || FLTIPOITEMPEDIDO || NUSEQPRODUTO || CDTIPOSOLAUTORIZACAO || CDCLIENTE);

ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN CDSOLAUTORIZACAO TYPE varchar(100);
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN CDTIPOSOLAUTORIZACAO DROP NOT NULL;
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN FLORIGEMPEDIDO DROP NOT NULL;
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN NUPEDIDO DROP NOT NULL;
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN CDCLIENTE DROP NOT NULL;
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN CDPRODUTO DROP NOT NULL;
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN FLTIPOITEMPEDIDO DROP NOT NULL;
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN NUSEQPRODUTO DROP NOT NULL;
UPDATE TBLVPRELNOVSOLAUTORIZACAO SET CDSOLAUTORIZACAO = (CDSOLAUTORIZACAO || NUPEDIDO || CDPRODUTO || CDTIPONOVIDADE || CDTIPOSOLAUTORIZACAO || FLORIGEMPEDIDO || FLTIPOITEMPEDIDO || NUSEQPRODUTO || CDCLIENTE);
--/POSTGRES

--SQLSERVER
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN CDSOLAUTORIZACAO VARCHAR(100) NOT NULL;
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN FLORIGEMPEDIDO CHAR(1);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN NUPEDIDO VARCHAR(30);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN CDCLIENTE VARCHAR(20);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN CDPRODUTO VARCHAR(20);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN FLTIPOITEMPEDIDO CHAR(1);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN NUSEQPRODUTO DECIMAL(9,0);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ALTER COLUMN CDTIPOSOLAUTORIZACAO DECIMAL(9,0);
GO
EXEC SP_RENAME 'TBLVPSOLAUTORIZACAO.FLITEMEXCLUIDO', 'FLEXCLUIDO', 'COLUMN';
GO
UPDATE TBLVPSOLAUTORIZACAO SET CDSOLAUTORIZACAO = CONCAT(CDSOLAUTORIZACAO, FLORIGEMPEDIDO, NUPEDIDO, CDPRODUTO, FLTIPOITEMPEDIDO, NUSEQPRODUTO, CDTIPOSOLAUTORIZACAO, CDCLIENTE);
GO

ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN CDSOLAUTORIZACAO VARCHAR(100) NOT NULL;
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN CDTIPOSOLAUTORIZACAO DECIMAL(9,0);
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN FLORIGEMPEDIDO CHAR(1);
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN NUPEDIDO VARCHAR(30);
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN CDCLIENTE VARCHAR(20);
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN CDPRODUTO VARCHAR(20);
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN FLTIPOITEMPEDIDO CHAR(1);
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ALTER COLUMN NUSEQPRODUTO DECIMAL(9,0);
GO
UPDATE TBLVPRELNOVSOLAUTORIZACAO SET CDSOLAUTORIZACAO = CONCAT(CDSOLAUTORIZACAO, NUPEDIDO, CDPRODUTO, CDTIPONOVIDADE, CDTIPOSOLAUTORIZACAO, FLORIGEMPEDIDO, FLTIPOITEMPEDIDO, NUSEQPRODUTO, CDCLIENTE);
GO
--/SQLSERVER

ALTER TABLE TBLVPSOLAUTORIZACAO ADD CDCONDICAOPAGAMENTO VARCHAR(40);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ADD VLPARCELAMINMAX DECIMAL(16,7);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ADD VLPARCELAPEDIDO DECIMAL(16,7);
GO
ALTER TABLE TBLVPSOLAUTORIZACAO ADD CONSTRAINT PK_TBLVPSOLAUTORIZACAO PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDSOLAUTORIZACAO, CDUSUARIO);
GO
ALTER TABLE TBLVPRELNOVSOLAUTORIZACAO ADD CONSTRAINT PK_TBLVPRELNOVSOLAUTORIZACAO PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDSOLAUTORIZACAO, CDTIPONOVIDADE, CDUSUARIO);
GO

/*-------------------------------------------------------------------------
LAV-32748
Autor: Suelen Roecker
Descrição: Novas Colunas
-------------------------------------------------------------------------*/

ALTER TABLE TBLVPPEDIDO ADD VLFRETEADICIONAL  DECIMAL(16,7);
GO
ALTER TABLE TBLVPPEDIDOERP ADD VLFRETEADICIONAL  DECIMAL(16,7);
GO

/*----------------------------
Atividade: LAV-32785
Autor: Gabriel Guedes
Data: 26/11/2021
Descrição: Continuação de correção de inconsistências de tamanhos de colunas entre banco App e Web
-----------------------------*/

ALTER TABLE TBLVPITEMKIT DROP CONSTRAINT PK_TBLVPITEMKIT;
GO

--ORACLE
DECLARE COUNT_INDEXES INTEGER; BEGIN SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPITEMKIT'; IF COUNT_INDEXES > 0 THEN EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPITEMKIT'; END IF; END;
/
ALTER TABLE TBLVPITEMKIT MODIFY CDTABELAPRECO VARCHAR(30);
/
--/ORACLE

--SQLSERVER
ALTER TABLE TBLVPITEMKIT ALTER COLUMN CDTABELAPRECO VARCHAR(30) NOT NULL;
GO
--/SQLSERVER

--POSTGRES
ALTER TABLE TBLVPITEMKIT ALTER COLUMN CDTABELAPRECO TYPE VARCHAR(30);
--/POSTGRES

ALTER TABLE TBLVPITEMKIT ADD CONSTRAINT PK_TBLVPITEMKIT PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDKIT, CDPRODUTO, CDTABELAPRECO, CDUNIDADE, CDUSUARIO);
GO

/*-------------------------------------------------------------------------
Atividade: LAV-32856
Autor: Gabriel Guedes
Data: 03/11/2021
Descrição: Nova coluna na tabela TributacaoConfig
-------------------------------------------------------------------------*/

ALTER TABLE TBLVPTRIBUTACAOCONFIG ADD FLREDUZICMSPISCOFINS CHAR(1);
GO

--VERSAO 7.005

/*-------------------------------------------------------------------------
LAV-32954
Autor: Matheus Schiavon
Descrição:Lowell - Campo de nuPrioridade
-------------------------------------------------------------------------*/

ALTER TABLE TBLVPBONIFCFG ADD CDTIPOREGRABONIFICACAO VARCHAR(20);

ALTER TABLE TBLVPBONIFCFG ADD FLBONIFICACAOAUTOMATICA CHAR(1);

/*-------------------------------------------------------------------------
LAV-32781
Autor: Matheus Schiavon
Descrição:Lowell - Campo de nuPrioridade
-------------------------------------------------------------------------*/

ALTER TABLE tblvpbonifcfg ADD NUPRIORIDADE DECIMAL(9,0);

/*----------------------------------
Atividade: LAV-31435
Autor: Rovani Pereira
Data: 24/11/2021
Descrição: Nova Entidade, funcionalidade de Politica de Bonificacao.
----------------------------------*/

CREATE TABLE TBLVPITEMPEDIDOBONIFCFG (
	CDEMPRESA VARCHAR(20) NOT NULL,
	CDREPRESENTANTE VARCHAR(20) NOT NULL,
	FLORIGEMPEDIDO CHAR(1) NOT NULL,
	NUPEDIDO VARCHAR(30) NOT NULL,
	CDPRODUTO VARCHAR(20) NOT NULL,
	FLTIPOITEMPEDIDO CHAR(1) NOT NULL,
	NUSEQPRODUTO DECIMAL(9,0) NOT NULL,
	CDBONIFCFG VARCHAR(20) NOT NULL,
	FLTIPOREGISTRO CHAR(1),
	VLBONIFICACAO DECIMAL(16,7),
	QTBONIFICACAO DECIMAL(16,7),
	NUCARIMBO DECIMAL(9),
	FLTIPOALTERACAO CHAR(1),
	CDUSUARIO VARCHAR(8) NOT NULL,
	DTALTERACAO DATETIME,
	HRALTERACAO VARCHAR(8),
CONSTRAINT PK_TBLVPITEMPEDIDOBONIFCFG PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, FLORIGEMPEDIDO, NUPEDIDO, CDPRODUTO, FLTIPOITEMPEDIDO, NUSEQPRODUTO, CDBONIFCFG, CDUSUARIO));
GO

--VERSAO 7.006

/*-------------------------------------------------------------------------
Atividade: LAV-32856
Autor: Gabriel Guedes
Data: 03/11/2021
Descrição: Nova coluna na tabela TributacaoConfig
-------------------------------------------------------------------------*/

ALTER TABLE TBLVPTRIBUTACAOCONFIG ADD FLREDUZICMSPISCOFINS CHAR(1);
GO

/*-------------------------------------------------------------------------
ATIVIDADE: LAV-32966
AUTOR: Gabriel Guedes
DATA: 20/12/2021
DESCRICAO: Novas colunas
-------------------------------------------------------------------------*/

ALTER TABLE TBLVPITEMTABELAPRECO ADD VLCOTACAOMOEDA DECIMAL(16, 7);
GO
ALTER TABLE TBLVPPRODUTO ADD DSMOEDAPRODUTO VARCHAR(100);
GO
ALTER TABLE TBLVPITEMPEDIDO ADD VLCOTACAOMOEDAPRODUTO DECIMAL(16, 7);
GO
ALTER TABLE TBLVPITEMPEDIDOERP ADD VLCOTACAOMOEDAPRODUTO DECIMAL(16, 7);
GO
ALTER TABLE TBLVPITEMPEDIDO ADD DSMOEDAVENDAPRODUTO VARCHAR(100);
GO
ALTER TABLE TBLVPITEMPEDIDOERP ADD DSMOEDAVENDAPRODUTO VARCHAR(100);
GO

/*----------------------------------
Atividade: LAV-31940
Autor: Peterson Martins
Data: 07/01/2020
Descrição: Funcionalidade para apresentar total de cubagem dos pedidos no resumo diário.
----------------------------------*/

ALTER TABLE TBLVPRESUMODIA ADD VLTOTALVOLUME DECIMAL(16,7);
GO

/*----------------------------
Atividade: VENDAS-291
Autor: Rovani Pereira
Data: 26/01/2022
Descrição: Ajuste tipo do parâmetro e Coluna. Funcionalidade de Política de Bonificação.
-------------------------------*/
--POSTGRES
ALTER TABLE TBLVPBONIFCFG ALTER COLUMN DSBONIFCFG TYPE VARCHAR(100);
--/POSTGRES

--SQLSERVER
ALTER TABLE TBLVPBONIFCFG ALTER COLUMN DSBONIFCFG VARCHAR(100);
GO
--/SQLSERVER

--ORACLE
ALTER TABLE TBLVPBONIFCFG MODIFY DSBONIFCFG VARCHAR2(100);
/
--/ORACLE



--VERSAO 7.007

/*-------------------------------------------------------------------------
LAV-30554
Autor: Renan
Descrição: Nova coluna
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPPRODUTO ADD DSAGRUPADORGRADE VARCHAR(100);
GO

ALTER TABLE TBLVPPRODUTO ADD DSAGRUPADORGRADECOMP VARCHAR(100);
GO

ALTER TABLE TBLVPMARCADOR ADD FLAGRUPADORGRADE CHAR(1);
GO
/*-------------------------------------------------------------------------
LAV-30554
Autor: Renan
Descrição: Nova coluna
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPPRODUTOGRADE ADD NUORDEMLINHA DECIMAL(9,0);
GO

ALTER TABLE TBLVPPRODUTOGRADE ADD NUORDEMCOLUNA DECIMAL(9,0);
GO

/*-------------------------------------------------------------------------
LAV-33010
Autor: Renan
Descrição: Ajuste nome de coluna
-------------------------------------------------------------------------*/
--ORACLE
ALTER TABLE TBLVPSTATUSPEDIDOPDA RENAME COLUMN FLCONSIDERADESCPROGFAMVLMIN TO FLCONSIDERADESCPROGVLMIN;
--/ORACLE

--POSTGRES
ALTER TABLE TBLVPSTATUSPEDIDOPDA RENAME COLUMN FLCONSIDERADESCPROGFAMVLMIN TO FLCONSIDERADESCPROGVLMIN;
--/POSTGRES

--SQLSERVER
EXEC SP_RENAME 'TBLVPSTATUSPEDIDOPDA.FLCONSIDERADESCPROGFAMVLMIN', 'FLCONSIDERADESCPROGVLMIN', 'COLUMN';
GO
--/SQLSERVER

ALTER TABLE TBLVPSTATUSPEDIDOPDA ADD FLCONSIDERAFAMILIA CHAR(1);
GO

ALTER TABLE TBLVPREQUISICAOSERVTIPO ADD FLOBRIGAPEDIDO CHAR(1);
GO
ALTER TABLE TBLVPSTATUSPEDIDOPDA ADD FLPERMITECANCELARPEDIDO CHAR(1);
GO
ALTER TABLE TBLVPREQUISICAOSERV ADD NUPEDIDO VARCHAR(30);
GO
ALTER TABLE TBLVPREQUISICAOSERV ADD FLORIGEMPEDIDO CHAR(1);
GO

CREATE TABLE TBLVPREQUISICAOSERVIMAGEM (
  CDEMPRESA			VARCHAR(20)		NOT NULL,
  CDREPRESENTANTE	VARCHAR(20)		NOT NULL,
  CDREQUISICAOSERV	VARCHAR(20)		NOT NULL,
  NMIMAGEM			VARCHAR(100)	NOT NULL,
  NUCARIMBO         DECIMAL(9,0)        NULL,
  FLTIPOALTERACAO   CHAR(1)             NULL,
  DTALTERACAO       DATETIME            NULL,
  HRALTERACAO       VARCHAR(8)          NULL,
  CDUSUARIO         VARCHAR(8)      NOT NULL,
  CONSTRAINT PK_TBLVPREQUISICAOSERVIMAGEM PRIMARY KEY(CDEMPRESA,CDREPRESENTANTE,CDREQUISICAOSERV,NMIMAGEM,CDUSUARIO)
)
GO

/*-------------------------------------------------------------------------
LAV-32324
Autor: Ronan Cardoso
Descrição:KARSTEN - Estoque Previsto
-------------------------------------------------------------------------*/
CREATE TABLE TBLVPESTOQUEINDUSTRIA (
	CDEMPRESA 				VARCHAR(20)			NOT NULL,
	CDREPRESENTANTE 		VARCHAR(20)			NOT NULL,
	CDINSUMO          		VARCHAR(20)		    NOT NULL,
	CDLOCALESTOQUE  		VARCHAR(20)			NOT NULL,
	FLORIGEMESTOQUE   		VARCHAR(1)			NOT NULL,
	DTESTOQUE   	    	DATETIME			NOT NULL,
	QTESTOQUE  		        DECIMAL(16,7)		NULL,
	NUCARIMBO               DECIMAL(9),
	FLTIPOALTERACAO         CHAR(1),
	CDUSUARIO               VARCHAR(8)          NOT NULL,
	DTALTERACAO             DATETIME,
	HRALTERACAO             VARCHAR(8),
	CONSTRAINT PK_TBLVPESTOQUEINDUSTRIA PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDINSUMO, CDLOCALESTOQUE, FLORIGEMESTOQUE, DTESTOQUE, CDUSUARIO)
)
GO

CREATE TABLE TBLVPINSUMOPRODUTO (
	CDEMPRESA 				VARCHAR(20)			NOT NULL,
	CDREPRESENTANTE 		VARCHAR(20)			NOT NULL,
	CDINSUMO          		VARCHAR(20)		    NOT NULL,
	CDPRODUTO  		        VARCHAR(20)			NOT NULL,
	DSINSUMO          		VARCHAR(100)	    NULL,
	NUCARIMBO               DECIMAL(9),
	FLTIPOALTERACAO         CHAR(1),
	CDUSUARIO               VARCHAR(8)          NOT NULL,
	DTALTERACAO             DATETIME,
	HRALTERACAO             VARCHAR(8),
	CONSTRAINT PK_TBLVPINSUMOPRODUTO PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDINSUMO, CDPRODUTO, CDUSUARIO)
)
GO

 CREATE TABLE TBLVPRESERVACORRENTE (
	CDEMPRESA 				VARCHAR(20)			NOT NULL,
	CDREPRESENTANTE    		VARCHAR(20)		    NOT NULL,
	NUPEDIDO      			VARCHAR(30)      	NOT NULL,
	CDPRODUTO  		        VARCHAR(20)			NOT NULL,
    CDRESERVA 				VARCHAR(200)		NOT NULL,
	FLTIPOESTOQUE           CHAR(1)             NULL,
	CDINSUMO  		        VARCHAR(20)			NULL,
	CDLOCALESTOQUE	        VARCHAR(20)			NULL,
	CDITEMGRADE1	        VARCHAR(20)			NULL,
	CDITEMGRADE2	        VARCHAR(20)			NULL,
	CDITEMGRADE3	        VARCHAR(20)			NULL,
	QTESTOQUE              	DECIMAL(16,7)       NULL,
	DTESTOQUE             	DATETIME            NULL,
    NUCARIMBO               DECIMAL(9),
    FLTIPOALTERACAO         CHAR(1),
    CDUSUARIO               VARCHAR(8)          NOT NULL,
    DTALTERACAO             DATETIME,
    HRALTERACAO             VARCHAR(8),
	CONSTRAINT PK_TBLVPRESERVACORRENTE PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, NUPEDIDO, CDPRODUTO, CDRESERVA, CDUSUARIO)
)
GO

/*-------------------------------------------------------------------------
LAV-32452
Autor: Suelen Roecker
Descrição: Novas Colunas
-------------------------------------------------------------------------*/

ALTER TABLE TBLVPCONFIGVALORMINIMO ADD FLAGRUPALINHAPRODUTOS CHAR (1);
GO

/*----------------------------
Atividade: LAV-32785
Autor: Gabriel Guedes
Data: 26/11/2021
Descrição: Continuação de correção de inconsistências de tamanhos de colunas entre banco App e Web
-----------------------------*/

ALTER TABLE TBLVPITEMKIT DROP CONSTRAINT PK_TBLVPITEMKIT;
GO

--ORACLE
DECLARE COUNT_INDEXES INTEGER; BEGIN SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPITEMKIT'; IF COUNT_INDEXES > 0 THEN EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPITEMKIT'; END IF; END;
/
ALTER TABLE TBLVPITEMKIT MODIFY CDTABELAPRECO VARCHAR(30);
/
--/ORACLE

--SQLSERVER
ALTER TABLE TBLVPITEMKIT ALTER COLUMN CDTABELAPRECO VARCHAR(30) NOT NULL;
GO
--/SQLSERVER

--POSTGRES
ALTER TABLE TBLVPITEMKIT ALTER COLUMN CDTABELAPRECO TYPE VARCHAR(30);
--/POSTGRES

ALTER TABLE TBLVPITEMKIT ADD CONSTRAINT PK_TBLVPITEMKIT PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDKIT, CDPRODUTO, CDTABELAPRECO, CDUNIDADE, CDUSUARIO);
GO

--VERSAO 7.008


/*----------------------------------
Atividade: LAV-33221
Autor: Fernando Hellmann
Data: 28/02/2022
Descricao: Exclusão de coluna
----------------------------------*/

ALTER TABLE TBLVPSTATUSPEDIDOPDA DROP COLUMN FLPERMITECANCELARPEDIDO;
GO

/*-------------------------------------------------------------------------
Atividade: LAV-32445
Autor: Danilo Marcelino
Data: 01/11/2021
Descrição: Nova coluna
-------------------------------------------------------------------------*/

ALTER TABLE TBLVPTRIBUTACAOVLBASE ADD VLPRECOMEDIOPONDERADO DECIMAL(16,7);
GO

--VERSAO 7.009

/*----------------------------------
Atividade: LAV-31320
Autor: Nzunzi António
Data: 02/03/2022
Descricao: Nova coluna na tabela PoliticaComercial e CondicaoPagamento
----------------------------------*/

ALTER TABLE TBLVPPOLITICACOMERCIAL ADD CDGRUPOCONDPAGTOPOLITCOMERC VARCHAR(20);
GO
ALTER TABLE TBLVPCONDICAOPAGAMENTO ADD CDGRUPOCONDPAGTOPOLITCOMERC VARCHAR(20);
GO

/*----------------------------------
Atividade: LAV-32131
Autor: Fernando Hellmann
Data: 10/03/2022
Descricao: Nova tabela e campos
----------------------------------*/

CREATE TABLE TBLVPACESSOMATERIAL (
	CDEMPRESA		VARCHAR(20)		NOT NULL,
	CDREPRESENTANTE	VARCHAR(20)		NOT NULL,
	CDUSUARIOACESSO	VARCHAR(20)		NOT NULL,
	CDACESSOMATERIAL VARCHAR(20)	NOT NULL,
	NMMATERIAL		VARCHAR(100)	NOT NULL,
	DTACESSO        DATETIME            NULL,
	HRACESSO        VARCHAR(8)          NULL,
    NUCARIMBO       DECIMAL(9,0)        NULL,
	FLTIPOALTERACAO CHAR(1)             NULL,
    CDUSUARIO       VARCHAR(8)		NOT NULL,
    DTALTERACAO     DATETIME            NULL,
    HRALTERACAO     VARCHAR(8)          NULL,
CONSTRAINT PK_TBLVPACESSOMATERIAL PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, CDUSUARIOACESSO, CDACESSOMATERIAL, CDUSUARIO)
);
GO

ALTER TABLE TBLVPCAMPO ADD FLCONTABILIZAACESSO CHAR(1) NULL;
GO

/*------------------------------------------------------------------------
Data: 13/03/2019
Autor: Guilherme Juncklaus
Data: 14/03/2022
Descrição: Alteração PK TBLVPCLIENTEPRODUTO
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPPRODUTOCLIENTE DROP CONSTRAINT PK_TBLVPPRODUTOCLIENTE;
GO

--SQLSERVER
ALTER TABLE TBLVPPRODUTOCLIENTE ALTER COLUMN FLTIPORELACAO CHAR(1);
GO
--/SQLSERVER

--POSTGRES
ALTER TABLE TBLVPPRODUTOCLIENTE ALTER COLUMN FLTIPORELACAO TYPE CHAR(1);
ALTER TABLE TBLVPPRODUTOCLIENTE ALTER COLUMN FLTIPORELACAO DROP NOT NULL;

GO
--/POSTGRES

--ORACLE
DECLARE COUNT_INDEXES INTEGER; BEGIN SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPPRODUTOCLIENTE'; IF COUNT_INDEXES > 0 THEN EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPPRODUTOCLIENTE'; END IF; END;

ALTER TABLE TBLVPPRODUTOCLIENTE MODIFY FLTIPORELACAO CHAR(1) NULL;
GO
--/ORACLE

ALTER TABLE TBLVPPRODUTOCLIENTE ADD CONSTRAINT PK_TBLVPPRODUTOCLIENTE PRIMARY KEY (CDEMPRESA,CDREPRESENTANTE,CDCLIENTE,CDPRODUTO,CDUSUARIO);
GO


--VERSAO 7.010

/*-------------------------------------------------------------------------
ATIVIDADE: LAV-31473
AUTOR: Gabriel Guedes
DATA: 20/12/2021
DESCRICAO: Nova coluna
-------------------------------------------------------------------------*/
ALTER TABLE TBLVPITEMPEDIDOBONIFCFG ADD FLBONIFICACAOAUTOMATICA CHAR(1);
GO

/*----------------------------------
Atividade: LAV-32738
Autor: Nzunzi Antonio
Data: 02/03/2022
Descricao: Novas colunas para Empresa e Produto. Funcionalidade de Deflator da CondiÃ§Ã£o de Pagamento.
----------------------------------*/

ALTER TABLE TBLVPEMPRESA ADD VLPCTJUROSMENSAL DECIMAL(16,7);
GO
ALTER TABLE TBLVPEMPRESA ADD QTDIASCARENCIAJUROS DECIMAL(9,0);
GO
ALTER TABLE TBLVPPRODUTO ADD FLFORMULACALCULODEFLATOR CHAR(1);
GO

/*----------------------------
Atividade: LAV-31479
Autor: Rovani Pereira
Data: 23/02/2022
Descrição: Nova coluna para Primary Key. Funcionalidade de Política de Bonificação.
-------------------------------*/

ALTER TABLE TBLVPITEMPEDIDOBONIFCFG DROP CONSTRAINT PK_TBLVPITEMPEDIDOBONIFCFG;
GO
UPDATE TBLVPITEMPEDIDOBONIFCFG SET FLTIPOREGISTRO = '0' WHERE FLTIPOREGISTRO IS NULL;

--SQLSERVER
ALTER TABLE TBLVPITEMPEDIDOBONIFCFG ALTER COLUMN FLTIPOREGISTRO CHAR(1) NOT NULL;
GO
--/SQLSERVER

--ORACLE
DECLARE
  COUNT_INDEXES INTEGER; 
BEGIN
  SELECT COUNT(*) INTO COUNT_INDEXES FROM USER_INDEXES WHERE INDEX_NAME = 'PK_TBLVPITEMPEDIDOBONIFCFG'; 
  IF COUNT_INDEXES > 0 THEN
    EXECUTE IMMEDIATE 'DROP INDEX PK_TBLVPITEMPEDIDOBONIFCFG'; 
  END IF; 
END;
/

ALTER TABLE TBLVPITEMPEDIDOBONIFCFG MODIFY FLTIPOREGISTRO CHAR(1) NOT NULL;
/
--/ORACLE

--POSTGRES
ALTER TABLE TBLVPITEMPEDIDOBONIFCFG ALTER COLUMN FLTIPOREGISTRO SET NOT NULL;
--/POSTGRES

ALTER TABLE TBLVPITEMPEDIDOBONIFCFG ADD CONSTRAINT PK_TBLVPITEMPEDIDOBONIFCFG PRIMARY KEY (CDEMPRESA, CDREPRESENTANTE, FLORIGEMPEDIDO, NUPEDIDO, CDPRODUTO, FLTIPOITEMPEDIDO, NUSEQPRODUTO, CDBONIFCFG, FLTIPOREGISTRO, CDUSUARIO);
GO

--VERSAO 7.011


--VERSAO 7.012

/*----------------------------
Atividade: LAV-33455
Autor: Rovani Pereira
Data: 12/04/2022
Descrição: Nova tabela de Política de Bonificação Conjunto.
-------------------------------*/

CREATE TABLE TBLVPBONIFCFGCONJUNTO (
   CDEMPRESA 			VARCHAR(20) 		NOT NULL,
   CDBONIFCFG 			VARCHAR(20) 		NOT NULL,
   CDCONJUNTO 			VARCHAR(20) 		NOT NULL,
   FLGERABONIFICACAO 		CHAR(1)			NULL,
   FLPERMITEBONIFICAR 		CHAR(1)			NULL,
   NUCARIMBO 			DECIMAL(9)			NULL,
   FLTIPOALTERACAO 			CHAR(1)			NULL,
   CDUSUARIO 			VARCHAR(8)  		NOT NULL,
   DTALTERACAO			DATETIME			NULL,
   HRALTERACAO			VARCHAR(8)			NULL,
   CONSTRAINT PK_TBLVPBONIFCFGCONJUNTO PRIMARY KEY (CDEMPRESA, CDBONIFCFG, CDCONJUNTO, CDUSUARIO)
);
GO

--VERSAO 7.013

/*----------------------------------
ATIVIDADE: VENDAS-705
AUTOR: MATHEUS SCHIAVON
DATA: 05/05/2022
DESCRICAO: ADIÃÃO COLUNA
----------------------------------*/

ALTER TABLE TBLVPPEDIDOBOLETO ADD NUTITULO  VARCHAR(20);
GO
ALTER TABLE TBLVPPEDIDOBOLETO ADD NUSUBDOC  VARCHAR(20);
GO